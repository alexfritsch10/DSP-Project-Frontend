<html>
	<head>
		<link rel="stylesheet" type="text/css" href="NEditor.css">
		<script src="NEditor.js"></script>
		<script>
			window.addEventListener("load",function(e){



				var n1 = new NEditor.Node("Client/Data Source");
				var n1o1 = n1.addOutput("Input Data");
				n1.addChild("BUTTON","add keyGroup","replicateKeyGroupButton");
				n1.setPosition(50,200);

				replicateKeyGroupSet ("Key Group 1", 300, 50, 700, 50, 700, 150, 700, 250, n1o1)
				replicateKeyGroupSet ("Key Group 2", 300, 450, 700, 370, 700, 470, 700, 570, n1o1)

				document.getElementById("replicateKeyGroupButton").addEventListener("click", function(){
					var el = document.getElementById('replicateKeyGroupButton');
					if(el){
						el.addEventListener("click", replicateKeyGroupSet ("Key Group 3", 300, 800, 700, 690, 700, 790, 700, 890, n1o1), false);
					}
					else {
						alert ("There are some error on finding client node, please try again!")
					}
				})
			});

		</script>
	</head>
<body>
<div class="submitButtonContainer">
	<button id="deployButton" class="submitButtons">DEPLOY</button>
	<button id="resetButton" class="submitButtons">RESET</button>
</div>
<script>
	document.getElementById("resetButton").addEventListener("click", function(){
		window.location.reload();
	})
	document.getElementById("deployButton").addEventListener("click", function () {

		fetch('dataTemplate.json')
				.then( r => r.text() )
				.then (function (data){
					var mydata = JSON.parse(data)
					// console.log( "JSON Template: " + JSON.stringify(mydata) )
					var keygroupName = document.getElementById("Key Group 1Name").value
					mydata['Resources'][0]['Properties']['KeyGroups'][0]['Name']=keygroupName
					var keygroupMutable = Boolean(document.getElementById("Key Group 1Mutable").value)
					mydata['Resources'][0]['Properties']['KeyGroups'][0]['Mutable']=keygroupMutable
					var keygroupExpiry = Number(document.getElementById("Key Group 1ExpireAt").value)
					mydata['Resources'][0]['Properties']['KeyGroups'][0]['Expiry']=keygroupExpiry
					var replica1Expiry = Number(document.getElementById("Key Group 1Replica1ExpireAt").value)
					mydata['Resources'][0]['Properties']['KeyGroups'][0]['Replicas'][0]['Expiry']=replica1Expiry
					var replica2Expiry = Number(document.getElementById("Key Group 2Replica1ExpireAt").value)
					mydata['Resources'][0]['Properties']['KeyGroups'][0]['Replicas'][1]['Expiry']=replica2Expiry
					console.log( "Request Body: " + JSON.stringify(mydata))
					// console.log(mydata)
				})
	})
</script>
<svg id="connsvg"></svg>
<div class="tableOfContent">
	<button class="tableOfContentButton" onclick="window.location.href='http://localhost:3000/';">
		Upload
	</button>
	<button class="tableOfContentButton" id="GUI">
		GUI
	</button>
	<button class="tableOfContentButton">
		CLI
	</button>
</div>
<p style="color:#a0a0a0; bottom:1px; position:absolute">
	- DONE:<br/>
	- enable create new key group sets by click on icon <br/>
	- set default values & configurable fields <br/>
	- convert GUI to json file <br/>
	<br/>
	- TODO:<br/>
	- send json to BE api<br/>
	- enable deploy of multiple keygroups at one time<br/>
	- enable delete key group<br/>
	<br><br>&copy; 2020 Mercury;
</p>


</body>
</html>